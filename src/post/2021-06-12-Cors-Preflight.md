---
slug: 2021-06-12-Cors-Preflight
title: Corsì™€ Preflight
author: Sanghun Lee
date: 2021-06-12 11:33:00 +0800
categories: [BE, Resource]
tags: [Cors, Prefilght]
math: true
mermaid: true
image:
  src: '../static/images/posts/google.png'
  width: 850
  height: 585
---

# <span>ì°¸ê³ !</span>

ì´ í¬ìŠ¤íŒ…ì€ <a href ="https://www.youtube.com/watch?v=-2TgkKYmJt4">ìš°ì•„í•œTech</a> ìœ íŠœë¸Œ ì±„ë„ì˜** [10ë¶„ í…Œì½”í†¡] ğŸŒ³ ë‚˜ë´„ì˜ CORS** í¬ìŠ¤íŒ…ì„ ë³´ê³  ê°œì¸ê³µë¶€ë¥¼ ìœ„í•´ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤ :)
ì¶”ê°€ì ìœ¼ë¡œ ì°¸ê³ í•œ í¬ìŠ¤íŒ…ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤

- [ë‹¤ë¥¸ ë„ë©”ì¸ê°„ ì¿ í‚¤ ì „ì†¡í•˜ê¸°(axiosì™€ express ì˜ˆì œ)
  ](https://www.zerocho.com/category/NodeJS/post/5e9bf5b18dcb9c001f36b275)

# CORSëŠ” ì™œ ì¡´ì¬í•˜ë‚˜

ì¡´ì¬ì˜ ì´ìœ ë¥¼ ì•Œê¸° ìœ„í•´ í•„ìš”í•œ ëª‡ê°€ì§€ ê°œë…ê³¼ ì˜ˆì‹œë¥¼ ë³´ì

## SOP(Same Origin Policy)

ë‹¤ë¥¸ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ì œí•œì„ ê±°ëŠ” ë³´ì•ˆ ë°©ì‹ì´ë‹¤.

### SOPë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ì˜ˆì‹œ

1. ì–´ë–¤ ìœ ì €ê°€ Facebookì— ë¡œê·¸ì¸ì„ í•˜ê³  í† í°ì„ ë°›ì•„ ë¡œê·¸ì¸ ê³¼ì •ì„ ì™„ë£Œí–‡ë‹¤.

2. ìœ ì €ëŠ” ë¡œê·¸ì¸í•œ ìƒíƒœë¡œ ì¬ë¯¸ìˆëŠ” ë©”ì¼ì„ **í•´ì»¤(http://hacker.com)**
   ë¡œ ë¶€í„° ë°›ì•˜ë‹¤(ë„ˆë¬´ ì¬ë¯¸ìˆì–´ì„œ í´ë¦­ì„ ì•ˆí•  ìˆ˜ ì—†ì„ ì •ë„)

3. í•´ì»¤ëŠ” ì¬ë¯¸ìˆëŠ” ë©”ì¼ ì•ˆì— ì„ì˜ë¡œ **í˜ì´ìŠ¤ë¶(http://facebook.com)**
   ì— ë¬´ì—‡ì¸ê°€ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆê²Œ í•´ë²„ë¦¬ëŠ” scriptì½”ë“œë¥¼ ì ì–´ ë³´ëƒˆë‹¤.

4. ì´ë•Œ í˜ì´ìŠ¤ë¶ì— **ìœ ì €ì˜ í† í°**ì„ ê°€ì§€ê³  **í•´ì»¤ì˜ ì¶œì²˜(origin)ì„ í†µí•´ ê¸€ì„ ì‘ì„±**í•˜ë ¤ê³  í•˜ê²Œ ëœë‹¤.

5. ì´ë•Œ SOP ì •ì±…ì— ì˜í•´ ìš”ì²­ì„ í™•ì¸í•˜ê³  **ë‹¤ë¥¸ ì¶œì²˜(origin)ì„ ê°€ì§€ê²Œ ë˜ë¯€ë¡œ** í˜ì´ìŠ¤ë¶ì—ì„œ ìì‹ ì˜ ì¶œì²˜ì™€ ë‹¤ë¥¸ì¶œì²˜ë¥¼ ê°€ì§€ë¯€ë¡œ SOPì •ì±…ì— ì˜í•´ í•´ë‹¹ ìš”ì²­ì„ ê±°ë¶€í•˜ê²Œ ëœë‹¤.

## ê·¸ë˜ì„œ CORSë€ ?

Cross-Origin Resource Sharingìœ¼ë¡œì„œ ë‹¤ë¥¸ ì¶œì²˜(origin)ì˜ ìì›ì„ ê³µìœ í•˜ëŠ” ê²ƒì´ë‹¤.

ì¶”ê°€ Http í—¤ë”ë¥¼ ì‚¬ìš©í•˜ì—¬, í•œ ì¶œì²˜ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ë¥¸ ì¶œì²˜ì˜ ì„ íƒí•œ ìì›ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ë„ë¡ ë¸Œë¼ìš°ì €ì— ì•Œë ¤ì£¼ëŠ” ì²´ì œì´ë‹¤.

### CORSì˜ ì ‘ê·¼ì œì–´ ì‹œë‚˜ë¦¬ì˜¤

### 1. ë‹¨ìˆœ ìš”ì²­(Simple Request)

Preflightì˜ ìš”ì²­ì—†ì´ ë°”ë¡œ ì„œë²„ë¡œ ìš”ì²­ì„ ë‚ ë¦¬ê²Œ ëœë‹¤.

GET, POST, HEAD ë©”ì„œë“œê°€ ë“¤ì–´ìˆê³  Content-Typeì´ ë“¤ì–´ìˆë‹¤.

### 2. í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­(Prefilght Request)

### prefilghtë€?

![](https://images.velog.io/images/cloudlee711/post/cf3dd9ed-372b-432e-9f5b-4ad8d7cd0cf2/image.png)

ì¶œì²˜:[https://livebook.manning.com/](https://livebook.manning.com/book/cors-in-action/chapter-4/15)

ë§ê¸€ ì¤‘ì— ë„ˆë¬´ ì˜ ì„¤ëª…ì„ í•´ë†“ìœ¼ì‹ ê²Œ ìˆì–´ ì¸ìš©ì„ í•´ë³´ê² ë‹¤..(ë”°ë¼ì¹˜ëŠ”ê±°ì§€ ë­..)
![](https://images.velog.io/images/cloudlee711/post/b0408967-b34e-45af-8f69-1a29e3e8bb3f/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-06-12%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%204.00.45.png)

- CROS specì´ ìƒê¸°ê¸° ì´ì „ì— ë§Œë“¤ì–´ì§„ ì„œë²„ë“¤ì€ ë¸Œë¼ìš°ì €ì˜ SOP Requestë§Œ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê°€ì •í•˜ì— ë§Œë“¤ì–´ì¡Œë‹¤.

- ê·¸ëŸ°ë°, cross-site requestê°€ CORSë¡œ ì¸í•´ ê°€ëŠ¥í•´ì¡Œê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ ì„œë²„ë“¤ì€ cross-site requestì— ëŒ€í•œ ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜(security mechanism)ì´ ì—†ë‹¤ë³´ë‹ˆ ë³´ì•ˆì ìœ¼ë¡œ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆì—ˆë‹¤.

- ì´ëŸ° ë³´ì•ˆì ì¸ ë¬¸ì œë“¤ì„ ë³´í˜¸í•˜ê¸° ìœ„í•´ CORS specì—ë‹¤ê°€ preflight requestë¥¼ í¬í•¨í•˜ì—¬ prefilght requestë¥¼ í†µí•´ ì„œë²„ê°€ CORSë¥¼ ì¸ì‹í•˜ê³  í•¸ë“¤ë§í•  ìˆ˜ ìˆëŠ”ì§€ ë¨¼ì € í™•ì¸ì„ í•˜ê²Œ í•œ ë’¤ , CORSë¥¼ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ì„œë²„ë“¤ì„ ë³´í˜¸í•˜ê²Œ ëœë‹¤.

- ë§Œì•½ preflight requestê°€ ì„œë²„ë¡œ ì „ì†¡ì„ í•˜ì˜€ì„ ë•Œ CORSë¥¼ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ì„œë²„ë¼ë©´ ì œëŒ€ë¡œ ëœ ì‘ë‹µ(response)ë¥¼ ë³´ë‚´ì§€ ëª»í•˜ê²Œ ë˜ê³  ê·¸ë ‡ê²Œ ë˜ë©´ ì‹¤ì œ clientë¡œ ë¶€í„°ì˜ ìš”ì²­(request)ë„ ì „ì†¡ë˜ì§€ ì•Šê²Œ ë˜ì–´ preflight ê°€ cross-origin ìš”ì²­(request)ì— ëŒ€ë¹„ ë˜ì§€ ì•Šì€ ì„œë²„ë¥¼ ë³´í˜¸í•´ì£¼ê²Œ ëœë‹¤.

### 3. ì¸ì¦ì •ë³´ í¬í•¨ ìš”ì²­(Credential Request)

ì¸ì¦ê´€ë ¨ í—¤ë”ë¥¼ í¬í•¨í• ë•Œ ì‚¬ìš©í•˜ëŠ” ìš”ì²­ì´ë‹¤.

- í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” credentials: "include" (ì´ì™¸ì—ë„ same origin ë“±ì˜ ì˜µì…˜ì´ ë” ìˆë‹¤.)
- originì´ ë‹¤ë¥¸ http í†µì‹ ì—ì„œëŠ” request headerì— ì¿ í‚¤ê°€ ìë™ìœ¼ë¡œ ë“¤ì–´ê°€ì§€ ì•ŠëŠ”ë‹¤.
- ë‹¤ë¥¸ ì¶œì²˜ì˜ ê²½ìš° ë¡œê·¸ì¸ ìœ ì§€ë¥¼ ìœ„í•œ ì¿ í‚¤ê°€ ì„œë¡œ ì „ì†¡ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì–´ í•´ë‹¹ ì˜µì…˜ì„ ì£¼ëŠ” ê²ƒìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ë‹¤.

ì„¤ì •ì€ ì„œë²„ì¸¡ì—ì„œëŠ” Acess-Control-Allow-Credential: true
ì´ë•Œ ì™€ì¼ë“œì¹´ë“œ(\*)ëŠ” ì•ˆëœë‹¤.

### 4. CORS í•´ê²°í•˜ê¸°!

1. í”„ë¡ íŠ¸ í”„ë¡ì‹œ ì„œë²„ì„¤ì •(ê°œë°œ í™˜ê²½)
   ê°œë°œ í™˜ê²½ì—ì„œ api ìš”ì²­ì„ í•˜ëŠ” targetì„ ë™ì¼í•œ í¬íŠ¸ë¡œ ì„¤ì •í•˜ê³  ê°œë°œí•˜ê¸°
2. ì§ì ‘ í—¤ë”ì— ì„¤ì •í•´ì£¼ê¸°
3. ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ì´ìš©í•˜ê¸°(?)
   -> ë‚˜ë´„ë‹˜ì€ springì— ë§ì¶°ì„œ ë°ì½”ë ˆì´í„°ì— origin ê°’ì„ ì„¤ì •í•´ì£¼ê³  CORSë¥¼ í•´ê²°í•˜ì‹  ê²ƒì„ ë³´ì—¬ì£¼ì‹  ë‹¤ìŒ configuration íŒŒì¼ì„ ë”°ë¡œ ë§Œë“¤ì–´ì„œ originsì™€ ê´€ë ¨ëœ ë©”ì„œë“œë¥¼ í†µí•´ í•´ê²°í•˜ì…¨ë‹¤.

   ë‚˜ëŠ” nodeë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ ì´ë¶€ë¶„ì€ nodeì— ë§ì¶°ì„œ ë‹¤ì‹œ ì ì–´ë³´ê² ë‹¤ ..

### 5. Nodeì— ë§ì¶°ì„œ í•´ê²°í•´ë³´ì.

ë…¸ë“œì—ì„œëŠ” cors ëª¨ë“ˆì„ importí•˜ì—¬ ì‚¬ìš©í•˜ë©´ í¸í•˜ê²Œ í•  ìˆ˜ ìˆëŠ”ë° useë©”ì„œë“œë¥¼ í†µí•´ ë¯¸ë“¤ì›¨ì–´ë¡œ ì ìš©í•´ì£¼ë©´ ëœë‹¤.

ë‚´ê°€ ì‘ì„±í•œ ì½”ë“œëŠ” originì„ requestê°€ ë“¤ì–´ì˜¤ëŠ” originê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•˜ê³  ìˆë‹¤.(ì‚¬ì‹¤ ìƒ wild cardì´ë‹¤)

ê·¸ë¦¬ê³  credential trueì„¤ì •ì„ í†µí•´ í”„ë¡ íŠ¸ì—ì„œëŠ” í—¤ë”ì— withCredential: trueë¥¼ í—¤ë”ì— ë‹´ì•„ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

#### ë°±ì—”ë“œ ì½”ë“œ

![](https://images.velog.io/images/cloudlee711/post/0d56ee86-07e1-4550-8fb7-5a7575634c6b/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-06-12%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%204.38.51.png)

ê·¸ë ‡ë‹¤ë©´ cors ëª¨ë“ˆì— ëŒ€í•´ ì¡°ê¸ˆ ë” íŒŒë³´ì.

![](https://images.velog.io/images/cloudlee711/post/e451a694-8ec7-4233-9129-fb1db3b95652/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-06-12%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%204.40.46.png)

ì¶œì²˜:[Express cors middleware](http://expressjs.com/en/resources/middleware/cors.html)

ìº¡ì³ë³¸ì˜ ì„¤ëª…ì—ë„ ìˆë“¯ì´ origin ì˜µì…˜ì„ í†µí•´ ì‹¤ì œë¡œ í•„ìš”í•œ ì¶œì²˜(origin)ë§Œ í—ˆìš©í•´ì¤„ ìˆ˜ë„ ìˆë‹¤.
